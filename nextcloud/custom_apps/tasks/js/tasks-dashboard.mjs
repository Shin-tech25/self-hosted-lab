/*! third party licenses: js/vendor.LICENSE.txt */
import{T as S}from"./TaskCreateDialog-BUXM79Wx.chunk.mjs";import{_ as I,c as i,a as h,o as s,h as U,R as x,B as $,r,E as p,s as l,H as f,e as m,b as k,t as v,F as M,d as w,u as B,I as D,f as W,L as O,k as z,at as P,q as j,bo as H,m as q,P as F,p as V,g as R,N as G,ai as J,S as o,a9 as K,bf as Q,aw as X,ab as Y,W as Z,b9 as tt,n as et,bm as at,bn as st}from"./store-BBMiux8F.chunk.mjs";import{N as A,C as nt,P as ot}from"./Plus-BCBwT1wI.chunk.mjs";const rt={data(){return{color:"currentColor"}}},it={role:"img",class:"task-icon"},lt=["width","height"],dt=["fill","stroke"];function ct(t,n,e,b,d,a){return s(),i("span",it,[(s(),i("svg",{width:t.size,height:t.size,viewBox:"0 0 32 32"},[h("path",{fill:d.color,stroke:d.color,"stroke-miterlimit":"10","stroke-width":".75",d:"m14.383 26.764s0.259-0.716 0.563-1.367c4.908-10.57 11.212-17.53 14.008-20.69 2.264-2.559 1.378-2.156 0.375-1.503-4.09 2.659-11.742 11.206-14.668 14.169-0.542 0.545-1.769 1.833-2.045 1.833-0.313 0-1.358-0.481-1.955-0.833-2.282-1.338-4.464-2.643-5.834-3.136-2.917-1.049-2.092-0.052-1.926 0.281 0.521 1.042 7.566 6.689 9.899 9.356 0.722 0.824 1.583 1.89 1.583 1.89z"},null,8,dt)],8,lt))])}const mt=I(rt,[["render",ct],["__scopeId","data-v-b78bc47d"]]),ut={name:"NcDashboardWidgetItem",components:{NcAvatar:x,NcActions:$,NcActionButton:A},props:{id:{type:[String,Number],default:void 0},targetUrl:{type:String,default:void 0},avatarUrl:{type:String,default:void 0},avatarUsername:{type:String,default:void 0},avatarIsNoUser:{type:Boolean,default:!1},overlayIconUrl:{type:String,default:void 0},mainText:{type:String,required:!0},subText:{type:String,default:""},itemMenu:{type:Object,default:()=>({})},forceMenu:{type:Boolean,default:!0}},data(){return{hovered:!1}},computed:{item(){return{id:this.id,targetUrl:this.targetUrl,avatarUrl:this.avatarUrl,avatarUsername:this.avatarUsername,overlayIconUrl:this.overlayIconUrl,mainText:this.mainText,subText:this.subText}},gotMenu(){return Object.keys(this.itemMenu).length!==0||!!this.$slots.actions},gotOverlayIcon(){return this.overlayIconUrl&&this.overlayIconUrl!==""}},methods:{onLinkClick(t){t.target.closest(".action-item")&&t.preventDefault()}}},ht=["src"],kt={class:"item__details"},yt=["title"],pt=["title"];function gt(t,n,e,b,d,a){const C=r("NcAvatar"),g=r("NcActionButton"),T=r("NcActions");return s(),i("div",{onMouseover:n[0]||(n[0]=y=>d.hovered=!0),onMouseleave:n[1]||(n[1]=y=>d.hovered=!1)},[(s(),p(O(e.targetUrl?"a":"div"),{href:e.targetUrl||void 0,target:e.targetUrl?"_blank":void 0,class:W({"item-list__entry":!0,"item-list__entry--has-actions-menu":a.gotMenu}),onClick:a.onLinkClick},{default:l(()=>[f(t.$slots,"avatar",{avatarUrl:e.avatarUrl,avatarUsername:e.avatarUsername},()=>[m(C,{class:"item-avatar",size:44,url:e.avatarUrl,user:e.avatarUsername,"is-no-user":e.avatarIsNoUser,"show-user-status":!a.gotOverlayIcon},null,8,["url","user","is-no-user","show-user-status"])],!0),e.overlayIconUrl?(s(),i("img",{key:0,class:"item-icon",alt:"",src:e.overlayIconUrl},null,8,ht)):k("",!0),h("div",kt,[h("h3",{title:e.mainText},v(e.mainText),9,yt),e.subText!==""?(s(),i("span",{key:0,class:"message",title:e.subText},v(e.subText),9,pt)):k("",!0)]),a.gotMenu?(s(),p(T,{key:1,"force-menu":e.forceMenu},{default:l(()=>[f(t.$slots,"actions",{},()=>[(s(!0),i(M,null,w(e.itemMenu,(y,c)=>(s(),p(g,{key:c,icon:y.icon,"close-after-click":!0,onClick:B(N=>t.$emit(c,a.item),["prevent","stop"])},{default:l(()=>[D(v(y.text),1)]),_:2},1032,["icon","onClick"]))),128))],!0)]),_:3},8,["force-menu"])):k("",!0)]),_:3},8,["href","target","class","onClick"]))],32)}const _=U(ut,[["render",gt],["__scopeId","data-v-c1cd11d9"]]);z(H);const ft={name:"NcDashboardWidget",components:{NcAvatar:x,NcDashboardWidgetItem:_,NcEmptyContent:P,Check:nt},props:{items:{type:Array,default:()=>[]},showMoreUrl:{type:String,default:""},showMoreLabel:{type:String,default:j("More items …")},loading:{type:Boolean,default:!1},itemMenu:{type:Object,default:()=>({})},showItemsAndEmptyContent:{type:Boolean,default:!1},emptyContentMessage:{type:String,default:""},halfEmptyContentMessage:{type:String,default:""}},computed:{handlers(){const t={};for(const n in this.itemMenu)t[n]=e=>{this.$emit(n,e)};return t},displayedItems(){const t=this.showMoreUrl&&this.items.length>=this.maxItemNumber?this.maxItemNumber-1:this.maxItemNumber;return this.items.slice(0,t)},showHalfEmptyContentArea(){return this.showItemsAndEmptyContent&&this.halfEmptyContentString&&this.items.length!==0},halfEmptyContentString(){return this.halfEmptyContentMessage||this.emptyContentMessage},maxItemNumber(){return this.showItemsAndEmptyContent?5:7},showMore(){return this.showMoreUrl&&this.items.length>=this.maxItemNumber}}},vt=t=>(V("data-v-ac2fc36c"),t=t(),R(),t),Ct={class:"dashboard-widget"},Tt={key:1},bt=vt(()=>h("div",{class:"item__details"},[h("h3",null," "),h("p",{class:"message"},"   ")],-1)),Mt=["href"];function wt(t,n,e,b,d,a){const C=r("Check"),g=r("NcEmptyContent"),T=r("NcDashboardWidgetItem"),y=r("NcAvatar");return s(),i("div",Ct,[a.showHalfEmptyContentArea?(s(),p(g,{key:0,description:a.halfEmptyContentString,class:"half-screen"},{icon:l(()=>[f(t.$slots,"halfEmptyContentIcon",{},()=>[m(C)],!0)]),_:3},8,["description"])):k("",!0),h("ul",null,[(s(!0),i(M,null,w(a.displayedItems,c=>(s(),i("li",{key:c.id},[f(t.$slots,"default",{item:c},()=>[m(T,q({ref_for:!0},c,{"item-menu":e.itemMenu},F(a.handlers)),null,16,["item-menu"])],!0)]))),128))]),e.loading?(s(),i("div",Tt,[(s(),i(M,null,w(7,c=>h("div",{key:c,class:"item-list__entry"},[m(y,{class:"item-avatar",size:44}),bt])),64))])):e.items.length===0?f(t.$slots,"empty-content",{key:2},()=>[e.emptyContentMessage?(s(),p(g,{key:0,description:e.emptyContentMessage},{icon:l(()=>[f(t.$slots,"emptyContentIcon",{},void 0,!0)]),_:3},8,["description"])):k("",!0)],!0):a.showMore?(s(),i("a",{key:3,href:e.showMoreUrl,target:"_blank",class:"more",tabindex:"0"},v(e.showMoreLabel),9,Mt)):k("",!0)])}const Dt=U(ft,[["render",wt],["__scopeId","data-v-ac2fc36c"]]),Nt={name:"Dashboard",components:{NcActionButton:A,NcButton:G,Check:J,NcDashboardWidget:Dt,NcDashboardWidgetItem:_,TaskCreateDialog:S,Plus:ot,TaskIcon:mt},data(){return{loading:!0,tasks:[],showAddTaskModal:!1,itemMenu:{markAsDone:{text:o("tasks","Mark as done"),icon:"icon-checkmark"}}}},computed:{...K({calendars:"getTaskCalendars"}),hasTaskToday(){return this.filteredTasks.some(t=>Q(t,"today"))},filteredTasks(){return X(this.tasks.filter(t=>!t.closed))}},mounted(){this.initializeEnvironment()},methods:{t:o,...Y(["toggleCompleted"]),async initializeEnvironment(){await Z.connect({enableCalDAV:!0}),await this.$store.dispatch("fetchCurrentUserPrincipal");let{calendars:t}=await this.$store.dispatch("getCalendarsAndTrashBin");t=t.filter(e=>e.supportsTasks);const n=[];if(t.forEach(e=>{n.indexOf(e.owner)===-1&&n.push(e.owner)}),n.forEach(e=>{this.$store.dispatch("fetchPrincipalByUrl",{url:e})}),t.length===0){const e=this.$OCA.Theming?.color||"#0082C9";await this.$store.dispatch("appendCalendar",{displayName:o("tasks","Tasks"),color:e})}await this.fetchTasks()},async fetchTasks(){this.loading=!0;const t=await Promise.all(this.calendars.map(n=>this.$store.dispatch("getTasksFromCalendar",{calendar:n,completed:!1,related:null})));this.tasks=[...t.flat()],this.loading=!1},formatSubtext(t){return t.dueMoment.isValid()?t.allDay?t.dueMoment.calendar(null,{lastDay:o("tasks","[Due yesterday]"),sameDay:o("tasks","[Due today]"),nextDay:o("tasks","[Due tomorrow]"),lastWeek:o("tasks","[Due] L"),nextWeek:o("tasks","[Due] L"),sameElse:o("tasks","[Due] L")}):t.dueMoment.calendar(null,{lastDay:o("tasks","[Due yesterday at] LT"),sameDay:o("tasks","[Due today at] LT"),nextDay:o("tasks","[Due tomorrow at] LT"),lastWeek:o("tasks","[Due] L [at] LT"),nextWeek:o("tasks","[Due] L [at] LT"),sameElse:o("tasks","[Due] L [at] LT")}):o("tasks","No due date assigned")},getTasksAppUrl(t){return tt("apps/tasks")+`/#/calendars/${t.calendar.id}/tasks/${t.uri}`},toggleAddTaskModel(){this.showAddTaskModal=!this.showAddTaskModal},async onMarkAsDone(t){await this.toggleCompleted(t),await this.fetchTasks()}}},It=["title"],Ut={key:0,class:"center-button"};function xt(t,n,e,b,d,a){const C=r("Check"),g=r("NcActionButton"),T=r("NcDashboardWidgetItem"),y=r("TaskIcon"),c=r("NcDashboardWidget"),N=r("Plus"),E=r("NcButton"),L=r("TaskCreateDialog");return s(),i("div",null,[m(c,{id:"tasks_panel",items:a.filteredTasks.slice(0,a.hasTaskToday?6:4),"empty-content-message":a.t("tasks","No upcoming tasks"),"show-more-text":a.t("tasks","upcoming tasks"),loading:d.loading,"show-items-and-empty-content":!a.hasTaskToday,"half-empty-content-message":a.t("tasks","No tasks today")},{default:l(({item:u})=>[m(T,{"main-text":u.summary,"sub-text":a.formatSubtext(u),"target-url":a.getTasksAppUrl(u)},{avatar:l(()=>[h("div",{class:"calendar-dot",style:et({"background-color":u.calendar.color}),title:u.calendar.displayName},null,12,It)]),actions:l(()=>[!u.calendar.readOnly&&!(u.calendar.isSharedWithMe&&u.class!=="PUBLIC")?(s(),p(g,{key:0,"close-after-click":!0,onClick:_t=>a.onMarkAsDone(u)},{icon:l(()=>[m(C,{size:20,decorative:""})]),default:l(()=>[D(" "+v(a.t("tasks","Mark as done")),1)]),_:2},1032,["onClick"])):k("",!0)]),_:2},1032,["main-text","sub-text","target-url"])]),emptyContentIcon:l(()=>[m(y)]),_:1},8,["items","empty-content-message","show-more-text","loading","show-items-and-empty-content","half-empty-content-message"]),d.loading?k("",!0):(s(),i("div",Ut,[m(E,{onClick:a.toggleAddTaskModel},{icon:l(()=>[m(N,{size:20,decorative:""})]),default:l(()=>[D(" "+v(a.t("tasks","Create a new task")),1)]),_:1},8,["onClick"]),d.showAddTaskModal?(s(),p(L,{key:0,onClose:a.toggleAddTaskModel},null,8,["onClose"])):k("",!0)]))])}const At=I(Nt,[["render",xt]]);document.addEventListener("DOMContentLoaded",()=>{OCA.Dashboard.register("tasks",t=>at(At).use(st).mount(t))});
