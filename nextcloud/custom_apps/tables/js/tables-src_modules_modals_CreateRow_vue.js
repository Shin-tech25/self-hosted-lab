"use strict";(self.webpackChunktables=self.webpackChunktables||[]).push([["src_modules_modals_CreateRow_vue"],{41058:(t,e,o)=>{o.d(e,{A:()=>_});var a=o(76333),n=o(85168),s=(o(18205),o(98077)),d=o(53334),l=o(64117),i=o(9795),r=o(65899),c=o(93742);const _={name:"CreateRow",components:{NcDialog:a.i$,ColumnFormComponent:s.A,NcCheckboxRadioSwitch:a.AO,NcNoteCard:a.mQ,NcButton:a.x1},mixins:[l.A],props:{showModal:{type:Boolean,default:!1},columns:{type:Array,default:null},isView:{type:Boolean,default:!1},elementId:{type:Number,default:null}},data:()=>({row:{},localLoading:!1,addNewAfterSave:!1,allowedProtocols:c.VY}),computed:{nonMetaColumns(){return this.columns.filter((t=>t.id>=0))},hasEmptyMandatoryRows(){return this.checkMandatoryFields(this.row)},hasInvalidUrlProtocol(){return this.nonMetaColumns.some((t=>"text-link"===t.type&&!this.isValidUrlProtocol(this.row[t.id])))}},watch:{showModal(){this.showModal&&this.$nextTick((()=>{this.$el.querySelector("input")?.focus()}))}},methods:{...(0,r.i0)(i.D,["insertNewRow"]),t:d.Tl,actionCancel(){this.reset(),this.addNewAfterSave=!1,this.$emit("close")},async actionConfirm(){this.localLoading=!0,await this.sendNewRowToBE(),this.localLoading=!1,this.addNewAfterSave?((0,n.Te)((0,d.Tl)("tables","Row successfully created.")),this.reset()):this.actionCancel()},async sendNewRowToBE(){if(!this.tablesStore){const{default:t}=await Promise.all([o.e("vendors-node_modules_nextcloud_axios_dist_index_mjs"),o.e("vendors-node_modules_vue_dist_vue_runtime_esm_js"),o.e("vendors-node_modules_nextcloud_auth_dist_index_mjs-node_modules_nextcloud_vue_dist_Components-10e4a1"),o.e("vendors-node_modules_path-browserify_index_js-node_modules_toastify-js_src_toastify_js-node_m-e96381"),o.e("vendors-node_modules_nextcloud_dialogs_dist_index_mjs-node_modules_nextcloud_router_dist_inde-72797a"),o.e("src_store_data_js-src_store_store_js"),o.e("store")]).then(o.bind(o,88166));this.tablesStore=t}try{const t={};for(const[e,o]of Object.entries(this.row))t[e]=o;await this.insertNewRow({viewId:this.isView?this.elementId:null,tableId:this.isView?null:this.elementId,data:t})}catch(t){console.error(t),(0,n.Qg)((0,d.Tl)("tables","Could not create new row"))}},reset(){this.row={}},onKeydown(t){"Enter"===t.key&&t.ctrlKey&&this.actionConfirm()}}}},43905:(t,e,o)=>{o.d(e,{X:()=>a,Y:()=>n});var a=function(){var t=this,e=t._self._c;return t.showModal?e("NcDialog",{attrs:{name:t.t("tables","Create row"),size:"large","data-cy":"createRowModal"},on:{closing:t.actionCancel}},[e("div",{staticClass:"modal__content",on:{keydown:t.onKeydown}},[t._l(t.nonMetaColumns,(function(o){return e("div",{key:o.id,attrs:{"data-cy":o.title}},[e("ColumnFormComponent",{attrs:{column:o,value:t.row[o.id]},on:{"update:value":function(e){return t.$set(t.row,o.id,e)}}}),t._v(" "),o.mandatory&&!t.isValueValidForColumn(t.row[o.id],o)?e("NcNoteCard",{attrs:{type:"error"}},[t._v("\n\t\t\t\t"+t._s(t.t("tables",'"{columnTitle}" should not be empty',{columnTitle:o.title}))+"\n\t\t\t")]):t._e(),t._v(" "),t.row[o.id]&&"text-link"===o.type&&!t.isValidUrlProtocol(t.row[o.id])?e("NcNoteCard",{attrs:{type:"error"}},[t._v("\n\t\t\t\t"+t._s(t.t("tables","Invalid protocol. Allowed: {allowed}",{allowed:t.allowedProtocols.join(", ")}))+"\n\t\t\t")]):t._e()],1)})),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"fix-col-4 space-T end"},[e("div",{staticClass:"padding-right"},[e("NcCheckboxRadioSwitch",{attrs:{checked:t.addNewAfterSave,type:"switch","data-cy":"createRowAddMoreSwitch"},on:{"update:checked":function(e){t.addNewAfterSave=e}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("tables","Add more"))+"\n\t\t\t\t\t")])],1),t._v(" "),t.localLoading?t._e():e("NcButton",{staticClass:"primary",attrs:{"aria-label":t.t("tables","Save row"),disabled:t.hasEmptyMandatoryRows||t.hasInvalidUrlProtocol,"data-cy":"createRowSaveButton"},on:{click:function(e){return t.actionConfirm()}}},[t._v("\n\t\t\t\t\t"+t._s(t.t("tables","Save"))+"\n\t\t\t\t")])],1)])],2)]):t._e()},n=[]},96131:(t,e,o)=>{o.d(e,{A:()=>l});var a=o(71354),n=o.n(a),s=o(76314),d=o.n(s)()(n());d.push([t.id,".modal-mask[data-v-6cdea4f8]{z-index:2001}.modal__content[data-v-6cdea4f8]{padding:20px}.modal__content .row .space-T[data-v-6cdea4f8],.modal__content .row.space-T[data-v-6cdea4f8]{padding-top:20px}.modal__content[data-v-6cdea4f8] :where([class*=fix-col-]){display:flex}.modal__content[data-v-6cdea4f8] :where(.slot){align-items:baseline}.modal__content[data-v-6cdea4f8] :where(.end){justify-content:end}.modal__content[data-v-6cdea4f8] :where(.slot.fix-col-2){min-width:50%}.modal__content[data-v-6cdea4f8] :where(.fix-col-3){display:inline-block}.modal__content[data-v-6cdea4f8] :where(.slot.fix-col-4 input,.slot.fix-col-4 .row){min-width:100% !important}.modal__content[data-v-6cdea4f8] :where(.name-parts){display:block !important;max-width:fit-content !important}.padding-right[data-v-6cdea4f8]{padding-right:calc(var(--default-grid-baseline)*3)}","",{version:3,sources:["webpack://./src/modules/modals/CreateRow.vue"],names:[],mappings:"AACA,6BACC,YAAA,CAGD,iCACC,YAAA,CAEA,6FAEC,gBAAA,CAGD,2DACC,YAAA,CAGD,+CACC,oBAAA,CAGD,8CACC,mBAAA,CAGD,yDACC,aAAA,CAGD,oDACC,oBAAA,CAGD,oFACC,yBAAA,CAGD,qDACC,wBAAA,CACA,gCAAA,CAIF,gCACC,kDAAA",sourceRoot:""}]);const l=d},97960:(t,e,o)=>{var a=o(85072),n=o.n(a),s=o(97825),d=o.n(s),l=o(77659),i=o.n(l),r=o(55056),c=o.n(r),_=o(10540),u=o.n(_),A=o(41113),m=o.n(A),w=o(96131),h={};h.styleTagTransform=m(),h.setAttributes=c(),h.insert=i().bind(null,"head"),h.domAPI=d(),h.insertStyleElement=u();n()(w.A,h),w.A&&w.A.locals&&w.A.locals},55276:(t,e,o)=>{o.d(e,{default:()=>s});var a=o(43905),n=o(66171);o(6189);const s=(0,o(14486).A)(n.A,a.X,a.Y,!1,null,"6cdea4f8",null).exports},66171:(t,e,o)=>{o.d(e,{A:()=>a});const a=o(41058).A},6189:(t,e,o)=>{o(97960)}}]);
//# sourceMappingURL=tables-src_modules_modals_CreateRow_vue.js.map?v=6fdc46d9385db9ac31dc