"use strict";(self.webpackChunktables=self.webpackChunktables||[]).push([["src_modules_modals_EditRow_vue"],{93062:(t,e,o)=>{o.d(e,{A:()=>_});var a=o(76333),l=o(85168),n=o(53334),s=(o(18205),o(98077)),i=o(16880),d=o(64117),r=o(65899),c=o(88166),u=o(9795),w=o(93742);const _={name:"EditRow",components:{NcDialog:a.i$,NcButton:a.x1,ColumnFormComponent:s.A,NcNoteCard:a.mQ},mixins:[i.A,d.A],props:{showModal:{type:Boolean,default:!1},columns:{type:Array,default:null},row:{type:Object,default:null},isView:{type:Boolean,default:!1},element:{type:Object,default:null}},data:()=>({localRow:null,prepareDeleteRow:!1,localLoading:!1,allowedProtocols:w.VY}),computed:{showDeleteButton(){return this.canDeleteData(this.element)&&!this.localLoading},nonMetaColumns(){return this.columns.filter((t=>t.id>=0))},hasEmptyMandatoryRows(){return this.checkMandatoryFields(this.localRow)},hasInvalidUrlProtocol(){return this.nonMetaColumns.some((t=>"text-link"===t.type&&!this.isValidUrlProtocol(this.localRow[t.id])))}},watch:{row(){this.row&&(this.$router.currentRoute.path.includes("/row/")&&this.$router.replace(this.$router.currentRoute.path.split("/row/")[0]),this.$router.push(this.$router.currentRoute.path+"/row/"+this.row.id),this.setActiveRowId(null),this.loadValues())}},mounted(){this.loadValues()},methods:{...(0,r.i0)(u.D,["updateRow","removeRow"]),...(0,r.i0)(c.I,["setActiveRowId"]),t:n.Tl,loadValues(){if(this.row){const t={};this.row.data.forEach((e=>{t[e.columnId]=e.value})),this.localRow=Object.assign({},t)}},actionCancel(){this.$router?.back(),this.reset(),this.$emit("close")},async actionConfirm(){this.localLoading=!0,await this.sendRowToBE(),this.localLoading=!1,this.actionCancel()},async sendRowToBE(){await this.loadStore();const t=[];for(const[e,o]of Object.entries(this.localRow))t.push({columnId:e,value:o??""});await this.updateRow({id:this.row.id,isView:this.isView,elementId:this.element.id,data:t})||(0,l.Qg)((0,n.Tl)("tables","Could not update row"))},reset(){this.localRow={},this.dataLoaded=!1,this.prepareDeleteRow=!1},actionDeleteRow(){this.deleteRowAtBE(this.row.id)},async deleteRowAtBE(t){await this.loadStore(),this.localLoading=!0;await this.removeRow({rowId:t,isView:this.isView,elementId:this.element.id})||(0,l.Qg)((0,n.Tl)("tables","Could not delete row.")),this.localLoading=!1,this.actionCancel()},async loadStore(){if(this.tablesStore)return;const{default:t}=await Promise.all([o.e("vendors-node_modules_nextcloud_axios_dist_index_mjs"),o.e("vendors-node_modules_vue_dist_vue_runtime_esm_js"),o.e("vendors-node_modules_nextcloud_auth_dist_index_mjs-node_modules_nextcloud_vue_dist_Components-10e4a1"),o.e("vendors-node_modules_path-browserify_index_js-node_modules_toastify-js_src_toastify_js-node_m-e96381"),o.e("vendors-node_modules_nextcloud_dialogs_dist_index_mjs-node_modules_nextcloud_router_dist_inde-72797a"),o.e("src_store_data_js-src_store_store_js"),o.e("store")]).then(o.bind(o,88166));this.tablesStore=t},onKeydown(t){"Enter"===t.key&&t.ctrlKey&&this.actionConfirm()}}}},55131:(t,e,o)=>{o.d(e,{X:()=>a,Y:()=>l});var a=function(){var t=this,e=t._self._c;return t.showModal?e("NcDialog",{attrs:{"data-cy":"editRowModal",name:t.t("tables","Edit row"),size:"large"},on:{closing:t.actionCancel}},[e("div",{staticClass:"modal__content",on:{keydown:t.onKeydown}},[t._l(t.nonMetaColumns,(function(o){return e("div",{key:o.id},[e("ColumnFormComponent",{attrs:{column:o,value:t.localRow[o.id]},on:{"update:value":function(e){return t.$set(t.localRow,o.id,e)}}}),t._v(" "),o.mandatory&&!t.isValueValidForColumn(t.localRow[o.id],o)?e("NcNoteCard",{attrs:{type:"error"}},[t._v("\n\t\t\t\t"+t._s(t.t("tables",'"{columnTitle}" should not be empty',{columnTitle:o.title}))+"\n\t\t\t")]):t._e(),t._v(" "),t.localRow[o.id]&&"text-link"===o.type&&!t.isValidUrlProtocol(t.localRow[o.id])?e("NcNoteCard",{attrs:{type:"error"}},[t._v("\n\t\t\t\t"+t._s(t.t("tables","Invalid protocol. Allowed: {allowed}",{allowed:t.allowedProtocols.join(", ")}))+"\n\t\t\t")]):t._e()],1)})),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"fix-col-4 space-T",class:{"justify-between":t.showDeleteButton,end:!t.showDeleteButton}},[t.showDeleteButton?e("div",[t.prepareDeleteRow?t._e():e("NcButton",{attrs:{"aria-label":t.t("tables","Delete"),type:"error","data-cy":"editRowDeleteButton"},on:{click:function(e){t.prepareDeleteRow=!0}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("tables","Delete"))+"\n\t\t\t\t\t")]),t._v(" "),t.prepareDeleteRow?e("NcButton",{attrs:{"data-cy":"editRowDeleteConfirmButton",wide:!0,"aria-label":t.t("tables","I really want to delete this row!"),type:"error"},on:{click:t.actionDeleteRow}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("tables","I really want to delete this row!"))+"\n\t\t\t\t\t")]):t._e()],1):t._e(),t._v(" "),t.canUpdateData(t.element)&&!t.localLoading?e("NcButton",{attrs:{"aria-label":t.t("tables","Save"),type:"primary","data-cy":"editRowSaveButton",disabled:t.hasEmptyMandatoryRows||t.hasInvalidUrlProtocol},on:{click:t.actionConfirm}},[t._v("\n\t\t\t\t\t"+t._s(t.t("tables","Save"))+"\n\t\t\t\t")]):t._e(),t._v(" "),t.localLoading?e("div",{staticClass:"icon-loading",staticStyle:{"margin-left":"20px"}}):t._e()],1)])],2)]):t._e()},l=[]},52857:(t,e,o)=>{o.d(e,{A:()=>i});var a=o(71354),l=o.n(a),n=o(76314),s=o.n(n)()(l());s.push([t.id,".modal-mask[data-v-5869641f]{z-index:2001}.modal__content[data-v-5869641f]{padding:20px}.modal__content[data-v-5869641f] :where(.row .space-T,.row.space-T){padding-top:20px}.modal__content[data-v-5869641f] :where([class*=fix-col-]){display:flex}.modal__content[data-v-5869641f] :where(.slot){align-items:baseline}.modal__content[data-v-5869641f] :where(.end){justify-content:end}.modal__content[data-v-5869641f] :where(.slot.fix-col-2){min-width:50%}.modal__content[data-v-5869641f] :where(.fix-col-1.end){display:flex;justify-content:flex-end}.modal__content[data-v-5869641f] :where(.fix-col-3){display:inline-block}.modal__content[data-v-5869641f] :where(.slot.fix-col-4 input,.slot.fix-col-4 .row){min-width:100% !important}.modal__content[data-v-5869641f] :where(.name-parts){display:block !important;max-width:fit-content !important}","",{version:3,sources:["webpack://./src/modules/modals/EditRow.vue"],names:[],mappings:"AACA,6BACC,YAAA,CAGD,iCACC,YAAA,CAEA,oEACC,gBAAA,CAGD,2DACC,YAAA,CAGD,+CACC,oBAAA,CAGD,8CACC,mBAAA,CAGD,yDACC,aAAA,CAGD,wDACC,YAAA,CACA,wBAAA,CAGD,oDACC,oBAAA,CAGD,oFACC,yBAAA,CAGD,qDACC,wBAAA,CACA,gCAAA",sourceRoot:""}]);const i=s},26326:(t,e,o)=>{var a=o(85072),l=o.n(a),n=o(97825),s=o.n(n),i=o(77659),d=o.n(i),r=o(55056),c=o.n(r),u=o(10540),w=o.n(u),_=o(41113),h=o.n(_),m=o(52857),A={};A.styleTagTransform=h(),A.setAttributes=c(),A.insert=d().bind(null,"head"),A.domAPI=s(),A.insertStyleElement=w();l()(m.A,A),m.A&&m.A.locals&&m.A.locals},30004:(t,e,o)=>{o.d(e,{default:()=>n});var a=o(55131),l=o(29659);o(11851);const n=(0,o(14486).A)(l.A,a.X,a.Y,!1,null,"5869641f",null).exports},29659:(t,e,o)=>{o.d(e,{A:()=>a});const a=o(93062).A},11851:(t,e,o)=>{o(26326)}}]);
//# sourceMappingURL=tables-src_modules_modals_EditRow_vue.js.map?v=c46705aa5a519e575cc4