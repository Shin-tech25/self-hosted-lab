/*! For license information please see admin.js.LICENSE.txt */
(()=>{"use strict";var e={580:e=>{var n=/["'&<>]/;e.exports=function(e){var t,s=""+e,i=n.exec(s);if(!i)return s;var a="",o=0,l=0;for(o=i.index;o<s.length;o++){switch(s.charCodeAt(o)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}l!==o&&(a+=s.substring(l,o)),l=o+1,a+=t}return l!==o?a+s.substring(l,o):a}}},n={};function s(t){var i=n[t];if(void 0!==i)return i.exports;var a=n[t]={exports:{}};return e[t](a,a.exports,s),a.exports}s.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return s.d(n,{a:n}),n},s.d=(e,n)=>{for(var t in n)s.o(n,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},s.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var i=s(580),a=s.n(i);const o=(e,n,t)=>{var s;const i=1===Object.assign({ocsVersion:2},t||{}).ocsVersion?1:2;return(null!=(s=null==t?void 0:t.baseURL)?s:c())+"/ocs/v"+i+".php"+l(e,n,t)},l=(e,n,t)=>{const s=Object.assign({escape:!0},t||{});return"/"!==e.charAt(0)&&(e="/"+e),i=(i=n||{})||{},e.replace(/{([^{}]*)}/g,(function(e,n){const t=i[n];return s.escape?encodeURIComponent("string"==typeof t||"number"==typeof t?t.toString():e):"string"==typeof t||"number"==typeof t?t.toString():e}));var i},r=(e,n,t)=>{var s,i,a;const o=Object.assign({noRewrite:!1},t||{}),r=null!=(s=null==t?void 0:t.baseURL)?s:u();return!0!==(null==(a=null==(i=null==window?void 0:window.OC)?void 0:i.config)?void 0:a.modRewriteWorking)||o.noRewrite?r+"/index.php"+l(e,n,t):r+l(e,n,t)},d=(e,n,t)=>{var s,i,a;const o=null!=(a=null==(i=null==(s=null==window?void 0:window.OC)?void 0:s.coreApps)?void 0:i.includes(e))&&a,l="php"===t.slice(-3);let r=u();return l&&!o?(r+="/index.php/apps/".concat(e),n&&(r+="/".concat(encodeURI(n))),"index.php"!==t&&(r+="/".concat(t))):l||o?(("settings"===e||"core"===e||"search"===e)&&"ajax"===n&&(r+="/index.php"),e&&(r+="/".concat(e)),n&&(r+="/".concat(n)),r+="/".concat(t)):(r=function(e){var n,t;return null!=(t=(null!=(n=window._oc_appswebroots)?n:{})[e])?t:""}(e),n&&(r+="/".concat(n,"/")),"/"!==r.at(-1)&&(r+="/"),r+=t),r},c=()=>window.location.protocol+"//"+window.location.host+u();function u(){let e=window._oc_webroot;if(typeof e>"u"){e=location.pathname;const n=e.indexOf("/index.php/");if(-1!==n)e=e.slice(0,n);else{const n=e.indexOf("/",1);e=e.slice(0,n>0?n:void 0)}}return e}!function(e,n,s,i){n.External||(n.External={}),Handlebars.registerHelper("isSelected",(function(e,n){return e===n})),Handlebars.registerHelper("join",(function(e){return s.isUndefined(e)?"":e.join("|")})),Handlebars.registerHelper("getLanguages",(function(){return n.External.App.availableLanguages})),Handlebars.registerHelper("getTypes",(function(){return n.External.App.availableTypes})),Handlebars.registerHelper("getDevices",(function(){return n.External.App.availableDevices})),Handlebars.registerHelper("getIcons",(function(){return n.External.App.availableIcons})),n.External.Models=n.External.Models||{},n.External.Models.Site=i.Model.extend({defaults:{name:"",url:"",lang:"",type:"link",device:"",icon:"external.svg",groups:[]},parse:function(e){return s.isUndefined(e.ocs)?e:e.ocs.data}}),n.External.Models.SiteCollection=i.Collection.extend({model:n.External.Models.Site,url:o("apps/external/api/v1/sites"),parse:function(e){return e.ocs.data.sites}}),n.External.App={_sites:null,$list:null,_renderSite:function(e){var s,i;return e.nameTXT=t("external","Name"),e.urlTXT=t("external","URL"),e.languageTXT=t("external","Language"),e.groupsTXT=t("external","Groups"),e.devicesTXT=t("external","Devices"),e.iconTXT=t("external","Icon"),e.positionTXT=t("external","Position"),e.redirectTXT=t("external","Redirect"),e.removeSiteTXT=t("external","Remove site"),e.noEmbedTXT=t("external","This site does not allow embedding"),e.deleteIMG=(s="core",(i="actions/delete.svg").includes(".")?d(s,"img",i):d(s,"img","".concat(i,".svg"))),n.External.Templates.site(e)},init:function(){const e=this;this.$list=$("ul.external_sites"),$("#add_external_site").click((function(n){n.preventDefault();const s=$(e._renderSite({id:"new-"+Date.now(),name:t("external","New site"),icon:"external.svg",type:"link",lang:"",device:""}));e._attachEvents(s),s.find(".options").removeClass("hidden"),e.$list.append(s)})),this.load()},load:function(){const e=this;$("#loading_sites").removeClass("hidden"),this.$list.empty(),this._sites=new n.External.Models.SiteCollection,this._sites.fetch({success:function(n,t){if($("#loading_sites").addClass("hidden"),e.availableIcons=t.ocs.data.icons,e._buildIconList(t.ocs.data.icons),e.availableLanguages=t.ocs.data.languages,e.availableTypes=t.ocs.data.types,e.availableDevices=t.ocs.data.devices,0===t.ocs.data.sites.length){const n=$(e._renderSite({id:"undefined"}));e._attachEvents(n),e.$list.append(n)}else e._render()}})},_render:function(){const e=this;s.each(this._sites.models,(function(n){const t=$(e._renderSite(n.attributes));e._attachEvents(t),"guest"===n.attributes.type&&t.find(".site-redirect-box").hide(),e.$list.append(t)}))},_attachEvents:function(n){n.find(".delete-button").click(s.bind(this._deleteSite,this)),n.find(".trigger-save").change(s.bind(this._saveSite,this)),n.find(".icon-more").on("click",(function(){n.find(".options").toggleClass("hidden")}));const t=this,i=n.find(".site-groups");e.Settings.setupGroupsSelect(i),i.change((function(e){t._saveSite(e)}))},_deleteSite:function(n){n.preventDefault();const t=$(n.target).closest("li"),i=this._sites.get(t.data("site-id"));t.removeClass("failure saved").addClass("saving"),s.isUndefined(i)?t.remove():i.destroy({success:function(){t.remove(),e.Settings&&e.Settings.Apps&&e.Settings.Apps.rebuildNavigation()}})},_saveSite:function(e){e.preventDefault();const n=this,t=$(e.target).closest("li"),i=this._sites.get(t.data("site-id")),o=t.find("input.site-groups").val(),l={name:t.find(".site-name").val(),url:t.find(".site-url").val(),lang:t.find(".site-lang").val(),type:t.find(".site-type").val(),device:t.find(".site-device").val(),redirect:t.find(".site-redirect").prop("checked")?1:0,groups:""===o?[]:o.split("|"),icon:t.find(".site-icon").val()};t.removeClass("failure saved").addClass("saving"),t.find(".invalid-value").removeClass("invalid-value"),"guest"===l.type?t.find(".site-redirect-box").hide():t.find(".site-redirect-box").show(),s.isUndefined(i)?this._sites.create(l,{success:function(e){t.data("site-id",e.get("id")),t.removeClass("saving").addClass("saved"),t.find("h3").html(a()(l.name)+" <small>"+a()(l.url)+"</small>"),setTimeout((function(){t.removeClass("saved")}),2500),n._rebuildNavigation()},error:function(e,n){s.isUndefined(n.responseJSON.ocs.data.field)||""===n.responseJSON.ocs.data.field||t.find(".site-"+n.responseJSON.ocs.data.field).addClass("invalid-value"),t.removeClass("saving").addClass("failure")}}):i.save(l,{success:function(){t.removeClass("saving").addClass("saved"),t.find("h3").html(a()(l.name)+" <small>"+a()(l.url)+"</small>"),$('#appmenu li[data-id="external_index'+i.get("id")+'"] span').text(l.name),setTimeout((function(){t.removeClass("saved")}),2500),n._rebuildNavigation()},error:function(e,n){s.isUndefined(n.responseJSON.ocs.data.field)||""===n.responseJSON.ocs.data.field||t.find(".site-"+n.responseJSON.ocs.data.field).addClass("invalid-value"),t.removeClass("saving").addClass("failure")}})},_buildIconList:function(e){const i=this,a=$("ul.icon-list");let o="",l=null;const r=[];a.empty(),s.each(e,(function(e){if(""===e.icon)return void r.push(e);if(""!==o&&e.name===o.replace("-dark.","."))return l.find("div.img").prepend($("<img>").attr("src",e.url)),l.find("span.name").prepend(e.name+" / "),l.addClass("twin-icons"),r.pop(),void r.push(s.extend(e,{name:e.name+" / "+o}));e.deleteTXT=t("external","Delete icon");const d=$(n.External.Templates.icon(e));i._attachEventsIcon(d),a.append(d),r.push(e),o=e.name,l=d})),this.availableIcons=r},_attachEventsIcon:function(e){e.find("span.icon-delete").click(s.bind(this._deleteIcon,this))},_deleteIcon:function(e){const n=$(e.currentTarget).parents("li"),t=n.attr("data-icon");$.ajax({type:"DELETE",url:r("/apps/external/icons/"+t)}).done((function(){n.slideUp(),setTimeout((function(){n.remove()}),750)}))},_rebuildNavigation:function(){e.Settings.Apps.rebuildNavigation()}}}(OC,OCA,_,OC.Backbone),window.addEventListener("DOMContentLoaded",(function(){OCA.External.App.init();const e=document.getElementById("uploadicon");e.onchange=function(){if("files"in e&&e.files.length>0){OC.msg.startAction("form.uploadButton span.msg",t("external","Uploading…")),$("label#uploadlogo").removeClass("icon-upload").addClass("icon-loading-small");const n=new FormData;n.append("uploadicon",e.files[0]),$.ajax({type:"POST",url:r("/apps/external/icons"),data:n,processData:!1,contentType:!1,success:()=>{OCA.External.App.load(),OC.msg.finishedSuccess("form.uploadButton span.msg",t("external","Reloading icon list…")),$("label#uploadlogo").addClass("icon-upload").removeClass("icon-loading-small")},error:e=>{_.isUndefined(e.responseJSON.error)?OC.msg.finishedError("form.uploadButton span.msg",t("external","Icon could not be uploaded")):OC.msg.finishedError("form.uploadButton span.msg",e.responseJSON.error),$("label#uploadlogo").addClass("icon-upload").removeClass("icon-loading-small")}})}}}))})();
//# sourceMappingURL=admin.js.map