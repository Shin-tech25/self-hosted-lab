{"version":3,"file":"epubviewer-public.mjs","sources":["../src/public.ts"],"sourcesContent":["import { generateUrl } from '@nextcloud/router';\n\n// FIXME: Hack for single public file view since it is not attached to the fileslist\nwindow.addEventListener('DOMContentLoaded', function () {\n  const mime = $('#mimetype').val();\n  const supportedMimetypes = [\n    'application/epub+zip',\n    // 'application/pdf', // Using the official Nextcloud PDF viewer instead\n    'application/x-cbr',\n    'application/x-cbz',\n    'application/comicbook+7z',\n    'application/comicbook+ace',\n    'application/comicbook+rar',\n    'application/comicbook+tar',\n    'application/comicbook+truecrypt',\n    'application/comicbook+zip',\n  ];\n\n  if ($('#isPublic').val() === undefined || !supportedMimetypes.includes(mime)) {\n    return;\n  }\n\n  const sharingToken = $('#sharingToken').val();\n  const downloadUrl = generateUrl('/s/{token}/download', { token: sharingToken });\n\n  const content = $('#files-public-content');\n  const footerElmt = document.querySelector('body > footer') ?? document.querySelector('#app-content > footer');\n  const mainContent = document.querySelector('#content');\n\n  const viewerUrl = generateUrl('/apps/epubviewer/?file={downloadUrl}&type={type}', { downloadUrl, type: mime });\n\n  // Create viewer frame\n  const viewerNode = document.createElement('iframe');\n  viewerNode.style.height = '100%';\n  viewerNode.style.width = '100%';\n  viewerNode.style.position = 'absolute';\n\n  // Inject viewer\n  content.empty();\n  content.append(viewerNode);\n  viewerNode.src = viewerUrl;\n  footerElmt.style.display = 'none';\n  mainContent.style.minHeight = 'calc(100% - var(--header-height))'; // Make the viewer take the whole height as the footer is now hidden.\n  // overwrite style in order to fix the viewer on public pages\n  mainContent.style.marginLeft = '0';\n  mainContent.style.marginRight = '0';\n  mainContent.style.width = '100%';\n  mainContent.style.borderRadius = 'unset';\n});\n"],"names":["mime","supportedMimetypes","sharingToken","downloadUrl","generateUrl","content","footerElmt","mainContent","viewerUrl","viewerNode"],"mappings":";+CAGA,OAAO,iBAAiB,mBAAoB,UAAY,CACtD,MAAMA,EAAO,EAAE,WAAW,EAAE,IAAI,EAC1BC,EAAqB,CACzB,uBAEA,oBACA,oBACA,2BACA,4BACA,4BACA,4BACA,kCACA,2BACF,EAEI,GAAA,EAAE,WAAW,EAAE,IAAI,IAAM,QAAa,CAACA,EAAmB,SAASD,CAAI,EACzE,OAGF,MAAME,EAAe,EAAE,eAAe,EAAE,IAAI,EACtCC,EAAcC,EAAY,sBAAuB,CAAE,MAAOF,EAAc,EAExEG,EAAU,EAAE,uBAAuB,EACnCC,EAAa,SAAS,cAAc,eAAe,GAAK,SAAS,cAAc,uBAAuB,EACtGC,EAAc,SAAS,cAAc,UAAU,EAE/CC,EAAYJ,EAAY,mDAAoD,CAAE,YAAAD,EAAa,KAAMH,EAAM,EAGvGS,EAAa,SAAS,cAAc,QAAQ,EAClDA,EAAW,MAAM,OAAS,OAC1BA,EAAW,MAAM,MAAQ,OACzBA,EAAW,MAAM,SAAW,WAG5BJ,EAAQ,MAAM,EACdA,EAAQ,OAAOI,CAAU,EACzBA,EAAW,IAAMD,EACjBF,EAAW,MAAM,QAAU,OAC3BC,EAAY,MAAM,UAAY,oCAE9BA,EAAY,MAAM,WAAa,IAC/BA,EAAY,MAAM,YAAc,IAChCA,EAAY,MAAM,MAAQ,OAC1BA,EAAY,MAAM,aAAe,OACnC,CAAC"}