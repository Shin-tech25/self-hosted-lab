{"version":3,"file":"epubviewer-ready.mjs","sources":["../src/ready.ts"],"sourcesContent":["document.onreadystatechange = function () {\n  if (document.readyState === 'complete') {\n    const type = getUrlParameter('type');\n    const file = getUrlParameter('file');\n    const options: object = {};\n    const $session = $('.session');\n\n    options.session = {};\n    options.session.filename = decodeURI($session.data('filename'));\n    options.session.format = $session.data('filetype');\n    options.session.fileId = $session.data('fileid');\n    options.session.title = options.session.filename;\n    options.session.nonce = $session.data('nonce') || '';\n    options.session.version = $session.data('version') || '';\n    options.session.annotations = $session.data('annotations') || {};\n    options.session.fileId = $session.data('fileid') || '';\n    options.session.scope = $session.data('scope') || '';\n    options.session.cursor = $session.data('cursor') || {};\n    options.session.defaults = $session.data('defaults') || {};\n    options.session.preferences = $session.data('preferences') || {};\n    options.session.defaults = $session.data('defaults') || {};\n    options.session.basePath = $session.data('basepath');\n    options.session.staticPath = $session.data('staticpath');\n    options.session.downloadLink = $session.data('downloadlink');\n\n    /* functions return jquery promises */\n    options.session.getPreference = function (name: string) {\n      return $.get(\n        options.session.basePath + 'preference/' + options.session.fileId + '/' + options.session.scope + '/' + name,\n      );\n    };\n    options.session.setPreference = function (name: string, value) {\n      return $.post(options.session.basePath + 'preference', {\n        fileId: options.session.fileId,\n        scope: options.session.scope,\n        name,\n        value: JSON.stringify(value),\n      });\n    };\n    options.session.deletePreference = function (name: string) {\n      return $.delete(\n        options.session.basePath + 'preference/' + options.session.fileId + '/' + options.session.scope + '/' + name,\n      );\n    };\n    options.session.getDefault = function (name: string) {\n      return $.get(options.session.basePath + 'preference/default/' + options.session.scope + '/' + name);\n    };\n    options.session.setDefault = function (name: string, value) {\n      return $.post(options.session.basePath + 'preference/default', {\n        scope: options.session.scope,\n        name,\n        value: JSON.stringify(value),\n      });\n    };\n    options.session.deleteDefault = function (name: string) {\n      return $.delete(options.session.basePath + 'preference/default/' + options.session.scope + '/' + name);\n    };\n    options.session.getBookmark = function (name: string, type: string) {\n      return $.get(options.session.basePath + 'bookmark/' + options.session.fileId + '/' + type + '/' + name);\n    };\n    options.session.setBookmark = function (name: string, value: object, type: string, content: object) {\n      return $.post(options.session.basePath + 'bookmark', {\n        fileId: options.session.fileId,\n        name,\n        value: JSON.stringify(value),\n        type,\n        content: JSON.stringify(content),\n      });\n    };\n    options.session.deleteBookmark = function (name: string) {\n      return $.delete(options.session.basePath + 'bookmark/' + options.session.fileId + '/' + name);\n    };\n    options.session.getCursor = function () {\n      return $.get(options.session.basePath + 'bookmark/cursor/' + options.session.fileId);\n    };\n    options.session.setCursor = function (value: object) {\n      return $.post(options.session.basePath + 'bookmark/cursor', {\n        fileId: options.session.fileId,\n        value: JSON.stringify(value),\n      });\n    };\n    options.session.deleteCursor = function () {\n      return $.delete(options.session.basePath + 'bookmark/cursor/' + options.session.fileId);\n    };\n\n    switch (type) {\n      case 'application/epub+zip':\n        options.contained = true;\n        renderEpub(file, options);\n        break;\n      case 'application/x-cbr':\n      case 'application/x-cbz':\n      case 'application/comicbook+7z':\n      case 'application/comicbook+ace':\n      case 'application/comicbook+rar':\n      case 'application/comicbook+tar':\n      case 'application/comicbook+truecrypt':\n      case 'application/comicbook+zip':\n        renderCbx(file, options);\n        break;\n      case 'application/pdf':\n        renderPdf(file, options);\n        break;\n      default:\n        console.log(type + ' is not supported by Reader');\n    }\n  }\n\n  function getUrlParameter(param: string): string {\n    const params = new URLSearchParams(window.location.search);\n    return params.get(param) ?? ''; // Returns the parameter value or an empty string if not found\n  }\n\n  // start epub.js renderer\n  function renderEpub(file: string, options: any): void {\n    // some parameters...\n    const session = $('.session');\n    const staticPath = session.data('staticpath');\n    EPUBJS.filePath = location.origin + staticPath + 'js/epubjs/';\n\n    // epub.js forcibly prepends EPUBJS.basePath to the cssPath.\n    // We add a bunch of .. to get rid of this incorrect path.\n    EPUBJS.cssPath = '../../..' + staticPath + 'js/epubjs/css/';\n    EPUBJS.basePath = location.origin + session.data('basepath');\n    EPUBJS.staticPath = location.origin + staticPath;\n\n    ePubViewer(file, options);\n  }\n\n  // start cbr.js renderer\n  function renderCbx(file: string, options: object): void {\n    CBRJS.filePath = 'js/cbrjs/';\n\n    cbReader(file, options);\n  }\n\n  // start pdf.js renderer\n  function renderPdf(file: string, options: object): void {\n    PDFJS.filePath = 'js/pdfjs/';\n    PDFJS.imageResourcesPath = 'js/pdfjs/css/images/';\n    PDFJS.workerSrc = options.session.staticPath + 'js/pdfjs/lib/pdf.worker.js';\n\n    pdfReader(file, options);\n  }\n};\n"],"names":["type","getUrlParameter","file","options","$session","name","value","content","renderEpub","renderCbx","renderPdf","param","session","staticPath"],"mappings":"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"}