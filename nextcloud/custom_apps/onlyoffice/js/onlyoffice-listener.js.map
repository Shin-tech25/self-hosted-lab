{"version":3,"file":"onlyoffice-listener.js?v=081a3500870308b71b20","mappings":"CAiCA,SAAUA,GAETA,EAAIC,WAAaC,EAAEC,OAAO,CACzBC,QAAS,aACTC,cAAe,KACfC,UAAWC,OAAOC,SAASC,MAC3BC,YAAaC,EAAE,oBAAoBC,KAAK,SACtCZ,EAAIC,YAEPD,EAAIC,WAAWY,eAAiB,WAE/BF,EAAEX,EAAIC,WAAWI,eAAeS,SAE5Bd,EAAIe,QAAUf,EAAIe,OAAOC,OAC5BhB,EAAIe,OAAOC,QAGRhB,EAAIC,WAAWgB,aAClBjB,EAAIC,WAAWgB,aAEjB,EAEAjB,EAAIC,WAAWiB,gBAAkB,SAASC,GAEzCC,GAAGC,QAAQC,WAAWC,EAAEvB,EAAIC,WAAWG,QAAS,YAC/C,SAASoB,GACRL,EAASM,IAAMD,EACfb,EAAEX,EAAIC,WAAWI,eAAe,GAAGqB,cAAc1B,IAAIC,WAAW0B,aAAaR,EAC9E,IACA,EACA,wBACA,EACAC,GAAGC,QAAQO,uBACXT,EAASM,IACX,EAEAzB,EAAIC,WAAW4B,qBAAuB,SAASC,GAC9CV,GAAGC,QAAQC,WAAWC,EAAEvB,EAAIC,WAAWG,QAAS,gBAC/CO,EAAEX,EAAIC,WAAWI,eAAe,GAAGqB,cAAc1B,IAAIC,WAAW8B,mBAChE,EACAD,GACA,EACF,EAEA9B,EAAIC,WAAW+B,6BAA+B,SAASC,GACtDb,GAAGC,QAAQC,WAAWC,EAAEvB,EAAIC,WAAWG,QAAS,qBAC/CO,EAAEX,EAAIC,WAAWI,eAAe,GAAGqB,cAAc1B,IAAIC,WAAWiC,oBAChE,EACAD,GACA,EACF,EAEAjC,EAAIC,WAAWkC,wBAA0B,SAASC,EAAcC,GAC/D,IAAI5B,EACJ,OAAQ4B,GACR,IAAK,UACJ5B,EAAQc,EAAEvB,EAAIC,WAAWG,QAAS,0BAClC,MACD,IAAK,UACJK,EAAQc,EAAEvB,EAAIC,WAAWG,QAAS,0BAClC,MACD,IAAK,cACJK,EAAQc,EAAEvB,EAAIC,WAAWG,QAAS,8BAClC,MACD,QACCK,EAAQc,EAAEvB,EAAIC,WAAWG,QAAS,eAEnCgB,GAAGC,QAAQC,WAAWb,EACrBE,EAAEX,EAAIC,WAAWI,eAAe,GAAGqB,cAAc1B,IAAIC,WAAWqC,mBAAmBC,KAAK,CAAEF,2BAC1F,EACAD,GACA,EACF,EAEApC,EAAIC,WAAWuC,yBAA2B,SAASC,GAClDrB,GAAGC,QAAQC,WAAWC,EAAEvB,EAAIC,WAAWG,QAAS,sBAC/CO,EAAEX,EAAIC,WAAWI,eAAe,GAAGqB,cAAc1B,IAAIC,WAAWyC,uBAChE,EACAD,GACA,EACF,EAEAzC,EAAIC,WAAW0C,gBAAkB,WAChC3C,EAAIC,WAAW2C,aAChB,EAEA5C,EAAIC,WAAW4C,cAAgB,SAASC,GACvCnC,EAAE,oBAAoBC,KAAK,OAAQkC,EACpC,EAEA9C,EAAIC,WAAW2C,YAAc,WAC5BpC,SAASuC,cAAc,yBAAyBC,aAAa,UAAW,4EACzE,EAEAhD,EAAIC,WAAWgD,cAAgB,SAASC,GACvC,OAAQA,EAAWC,MACnB,IAAK,UACJC,IAAIC,MAAMC,QAAQJ,EAAWK,QAASL,EAAWM,OACjD,MACD,IAAK,QACJJ,IAAIC,MAAMI,MAAMP,EAAWK,QAASL,EAAWM,OAGjD,EAEAjD,OAAOmD,iBAAiB,WAAW,SAASC,GAC3C,GAAKhD,EAAEX,EAAIC,WAAWI,eAAeuD,QACjCjD,EAAEX,EAAIC,WAAWI,eAAe,GAAGqB,gBAAkBiC,EAAME,QAC1DF,EAAMG,KAAKC,OAGhB,OAAQJ,EAAMG,KAAKC,QACnB,IAAK,qBACJ/D,EAAIC,WAAWY,iBACf,MACD,IAAK,+BACAb,EAAIC,WAAW+D,iBAClBhE,EAAIC,WAAW+D,kBAEhB,MACD,IAAK,0BACAhE,EAAIC,WAAWgE,uBAClBjE,EAAIC,WAAWgE,wBAEhB,MACD,IAAK,sBACJjE,EAAIC,WAAWiB,gBAAgByC,EAAMG,KAAKI,OAC1C,MACD,IAAK,2BACJlE,EAAIC,WAAW4B,qBAAqB8B,EAAMG,KAAKI,OAC/C,MACD,IAAK,mCACJlE,EAAIC,WAAW+B,6BAA6B2B,EAAMG,KAAKI,OACvD,MACD,IAAK,8BACJlE,EAAIC,WAAWkC,wBAAwBwB,EAAMG,KAAKI,MAAOP,EAAMG,KAAKzB,uBACpE,MACD,IAAK,+BACJrC,EAAIC,WAAWuC,yBAAyBmB,EAAMG,KAAKI,OACnD,MACD,IAAK,kBACJlE,EAAIC,WAAW0C,gBAAgBgB,EAAMG,KAAKI,OAC1C,MACD,IAAK,gBACJlE,EAAIC,WAAW4C,cAAcc,EAAMG,KAAKI,OACxC,MACD,IAAK,gBACJlE,EAAIC,WAAWgD,cAAcU,EAAMG,KAAKI,OAG1C,IAAG,GAEH3D,OAAOmD,iBAAiB,YAAY,SAASC,GACxChD,EAAEX,EAAIC,WAAWI,eAAeuD,QACnC5D,EAAIC,WAAWY,gBAEjB,IAEyB,IAAIsD,kBAAiBC,IACzCA,EAAgB,IAAMA,EAAgB,GAAGC,cAC5CD,EAAgB,GAAGC,aAAaC,SAASC,IACpCA,EAAKC,IAAM,IAAMD,EAAKC,KAAOxE,EAAIC,WAAWI,gBAC/CL,EAAIC,WAAW4C,cAAc7C,EAAIC,WAAWS,aAC5CH,OAAOC,SAASC,MAAQT,EAAIC,WAAWK,UACvCN,EAAIC,WAAWI,cAAgB,KAChC,GAEF,IAGgBoE,QAAQjE,SAASuC,cAAc,QAAS,CACxD2B,WAAW,EACXC,SAAS,EACTC,uBAAuB,GAGxB,CAhLD,CAgLG5E","sources":["webpack:///onlyoffice/src/listener.js"],"sourcesContent":["/**\n *\n * (c) Copyright Ascensio System SIA 2025\n *\n * This program is a free software product.\n * You can redistribute it and/or modify it under the terms of the GNU Affero General Public License\n * (AGPL) version 3 as published by the Free Software Foundation.\n * In accordance with Section 7(a) of the GNU AGPL its Section 15 shall be amended to the effect\n * that Ascensio System SIA expressly excludes the warranty of non-infringement of any third-party rights.\n *\n * This program is distributed WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * For details, see the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html\n *\n * You can contact Ascensio System SIA at 20A-12 Ernesta Birznieka-Upisha street, Riga, Latvia, EU, LV-1050.\n *\n * The interactive user interfaces in modified source and object code versions of the Program\n * must display Appropriate Legal Notices, as required under Section 5 of the GNU AGPL version 3.\n *\n * Pursuant to Section 7(b) of the License you must retain the original Product logo when distributing the program.\n * Pursuant to Section 7(e) we decline to grant you any rights under trademark law for use of our trademarks.\n *\n * All the Product's GUI elements, including illustrations and icon sets, as well as technical\n * writing content are licensed under the terms of the Creative Commons Attribution-ShareAlike 4.0 International.\n * See the License terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode\n *\n */\n\n/* global _, $ */\n\n/**\n * @param {object} OCA Nextcloud OCA object\n */\n(function(OCA) {\n\n\tOCA.Onlyoffice = _.extend({\n\t\tAppName: 'onlyoffice',\n\t\tframeSelector: null,\n\t\ttitleBase: window.document.title,\n\t\tfavIconBase: $('link[rel=\"icon\"]').attr('href'),\n\t}, OCA.Onlyoffice)\n\n\tOCA.Onlyoffice.onRequestClose = function() {\n\n\t\t$(OCA.Onlyoffice.frameSelector).remove()\n\n\t\tif (OCA.Viewer && OCA.Viewer.close) {\n\t\t\tOCA.Viewer.close()\n\t\t}\n\n\t\tif (OCA.Onlyoffice.CloseEditor) {\n\t\t\tOCA.Onlyoffice.CloseEditor()\n\t\t}\n\t}\n\n\tOCA.Onlyoffice.onRequestSaveAs = function(saveData) {\n\n\t\tOC.dialogs.filepicker(t(OCA.Onlyoffice.AppName, 'Save as'),\n\t\t\tfunction(fileDir) {\n\t\t\t\tsaveData.dir = fileDir\n\t\t\t\t$(OCA.Onlyoffice.frameSelector)[0].contentWindow.OCA.Onlyoffice.editorSaveAs(saveData)\n\t\t\t},\n\t\t\tfalse,\n\t\t\t'httpd/unix-directory',\n\t\t\ttrue,\n\t\t\tOC.dialogs.FILEPICKER_TYPE_CHOOSE,\n\t\t\tsaveData.dir)\n\t}\n\n\tOCA.Onlyoffice.onRequestInsertImage = function(imageMimes) {\n\t\tOC.dialogs.filepicker(t(OCA.Onlyoffice.AppName, 'Insert image'),\n\t\t\t$(OCA.Onlyoffice.frameSelector)[0].contentWindow.OCA.Onlyoffice.editorInsertImage,\n\t\t\tfalse,\n\t\t\timageMimes,\n\t\t\ttrue)\n\t}\n\n\tOCA.Onlyoffice.onRequestMailMergeRecipients = function(recipientMimes) {\n\t\tOC.dialogs.filepicker(t(OCA.Onlyoffice.AppName, 'Select recipients'),\n\t\t\t$(OCA.Onlyoffice.frameSelector)[0].contentWindow.OCA.Onlyoffice.editorSetRecipient,\n\t\t\tfalse,\n\t\t\trecipientMimes,\n\t\t\ttrue)\n\t}\n\n\tOCA.Onlyoffice.onRequestSelectDocument = function(revisedMimes, documentSelectionType) {\n\t\tlet title\n\t\tswitch (documentSelectionType) {\n\t\tcase 'combine':\n\t\t\ttitle = t(OCA.Onlyoffice.AppName, 'Select file to combine')\n\t\t\tbreak\n\t\tcase 'compare':\n\t\t\ttitle = t(OCA.Onlyoffice.AppName, 'Select file to compare')\n\t\t\tbreak\n\t\tcase 'insert-text':\n\t\t\ttitle = t(OCA.Onlyoffice.AppName, 'Select file to insert text')\n\t\t\tbreak\n\t\tdefault:\n\t\t\ttitle = t(OCA.Onlyoffice.AppName, 'Select file')\n\t\t}\n\t\tOC.dialogs.filepicker(title,\n\t\t\t$(OCA.Onlyoffice.frameSelector)[0].contentWindow.OCA.Onlyoffice.editorSetRequested.bind({ documentSelectionType }),\n\t\t\tfalse,\n\t\t\trevisedMimes,\n\t\t\ttrue)\n\t}\n\n\tOCA.Onlyoffice.onRequestReferenceSource = function(referenceSourceMimes) {\n\t\tOC.dialogs.filepicker(t(OCA.Onlyoffice.AppName, 'Select data source'),\n\t\t\t$(OCA.Onlyoffice.frameSelector)[0].contentWindow.OCA.Onlyoffice.editorReferenceSource,\n\t\t\tfalse,\n\t\t\treferenceSourceMimes,\n\t\t\ttrue)\n\t}\n\n\tOCA.Onlyoffice.onDocumentReady = function() {\n\t\tOCA.Onlyoffice.setViewport()\n\t}\n\n\tOCA.Onlyoffice.changeFavicon = function(favicon) {\n\t\t$('link[rel=\"icon\"]').attr('href', favicon)\n\t}\n\n\tOCA.Onlyoffice.setViewport = function() {\n\t\tdocument.querySelector('meta[name=\"viewport\"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0')\n\t}\n\n\tOCA.Onlyoffice.onShowMessage = function(messageObj) {\n\t\tswitch (messageObj.type) {\n\t\tcase 'success':\n\t\t\tOCP.Toast.success(messageObj.message, messageObj.props)\n\t\t\tbreak\n\t\tcase 'error':\n\t\t\tOCP.Toast.error(messageObj.message, messageObj.props)\n\t\t\tbreak\n\t\t}\n\t}\n\n\twindow.addEventListener('message', function(event) {\n\t\tif (!$(OCA.Onlyoffice.frameSelector).length\n\t\t\t|| $(OCA.Onlyoffice.frameSelector)[0].contentWindow !== event.source\n\t\t\t|| !event.data.method) {\n\t\t\treturn\n\t\t}\n\t\tswitch (event.data.method) {\n\t\tcase 'editorRequestClose':\n\t\t\tOCA.Onlyoffice.onRequestClose()\n\t\t\tbreak\n\t\tcase 'editorRequestSharingSettings':\n\t\t\tif (OCA.Onlyoffice.OpenShareDialog) {\n\t\t\t\tOCA.Onlyoffice.OpenShareDialog()\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'onRefreshVersionsDialog':\n\t\t\tif (OCA.Onlyoffice.RefreshVersionsDialog) {\n\t\t\t\tOCA.Onlyoffice.RefreshVersionsDialog()\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'editorRequestSaveAs':\n\t\t\tOCA.Onlyoffice.onRequestSaveAs(event.data.param)\n\t\t\tbreak\n\t\tcase 'editorRequestInsertImage':\n\t\t\tOCA.Onlyoffice.onRequestInsertImage(event.data.param)\n\t\t\tbreak\n\t\tcase 'editorRequestMailMergeRecipients':\n\t\t\tOCA.Onlyoffice.onRequestMailMergeRecipients(event.data.param)\n\t\t\tbreak\n\t\tcase 'editorRequestSelectDocument':\n\t\t\tOCA.Onlyoffice.onRequestSelectDocument(event.data.param, event.data.documentSelectionType)\n\t\t\tbreak\n\t\tcase 'editorRequestReferenceSource':\n\t\t\tOCA.Onlyoffice.onRequestReferenceSource(event.data.param)\n\t\t\tbreak\n\t\tcase 'onDocumentReady':\n\t\t\tOCA.Onlyoffice.onDocumentReady(event.data.param)\n\t\t\tbreak\n\t\tcase 'changeFavicon':\n\t\t\tOCA.Onlyoffice.changeFavicon(event.data.param)\n\t\t\tbreak\n\t\tcase 'onShowMessage':\n\t\t\tOCA.Onlyoffice.onShowMessage(event.data.param)\n\t\t\tbreak\n\t\t}\n\t}, false)\n\n\twindow.addEventListener('popstate', function(event) {\n\t\tif ($(OCA.Onlyoffice.frameSelector).length) {\n\t\t\tOCA.Onlyoffice.onRequestClose()\n\t\t}\n\t})\n\n\tconst mutationObserver = new MutationObserver(mutationRecords => {\n\t\tif (mutationRecords[0] && mutationRecords[0].removedNodes) {\n\t\t\tmutationRecords[0].removedNodes.forEach((node) => {\n\t\t\t\tif (node.id && '#' + node.id === OCA.Onlyoffice.frameSelector) {\n\t\t\t\t\tOCA.Onlyoffice.changeFavicon(OCA.Onlyoffice.favIconBase)\n\t\t\t\t\twindow.document.title = OCA.Onlyoffice.titleBase\n\t\t\t\t\tOCA.Onlyoffice.frameSelector = null\n\t\t\t\t}\n\t\t\t  })\n\t\t}\n\t  })\n\n\tmutationObserver.observe(document.querySelector('body'), {\n\t\tchildList: true,\n\t\tsubtree: true,\n\t\tcharacterDataOldValue: true,\n\t  })\n\n})(OCA)\n"],"names":["OCA","Onlyoffice","_","extend","AppName","frameSelector","titleBase","window","document","title","favIconBase","$","attr","onRequestClose","remove","Viewer","close","CloseEditor","onRequestSaveAs","saveData","OC","dialogs","filepicker","t","fileDir","dir","contentWindow","editorSaveAs","FILEPICKER_TYPE_CHOOSE","onRequestInsertImage","imageMimes","editorInsertImage","onRequestMailMergeRecipients","recipientMimes","editorSetRecipient","onRequestSelectDocument","revisedMimes","documentSelectionType","editorSetRequested","bind","onRequestReferenceSource","referenceSourceMimes","editorReferenceSource","onDocumentReady","setViewport","changeFavicon","favicon","querySelector","setAttribute","onShowMessage","messageObj","type","OCP","Toast","success","message","props","error","addEventListener","event","length","source","data","method","OpenShareDialog","RefreshVersionsDialog","param","MutationObserver","mutationRecords","removedNodes","forEach","node","id","observe","childList","subtree","characterDataOldValue"],"sourceRoot":""}