!function(e,o){e(document).ready((function(){OCA.Onlyoffice=_.extend({},OCA.Onlyoffice),OCA.Onlyoffice.AppName||(OCA.Onlyoffice={AppName:"onlyoffice"});const c=function(){e("#onlyofficeSecretPanel").toggleClass("onlyoffice-hide"),e("#onlyofficeAdv .icon").toggleClass("icon-triangle-s icon-triangle-n")};(e("#onlyofficeInternalUrl").val().length||e("#onlyofficeStorageUrl").val().length||e("#onlyofficeJwtHeader").val().length)&&c(),e("#onlyofficeAdv").click(c),e("#onlyofficeGroups").prop("checked",""!==e("#onlyofficeLimitGroups").val());const n=function(){e("#onlyofficeGroups").prop("checked")?o.Settings.setupGroupsSelect(e("#onlyofficeLimitGroups")):e("#onlyofficeLimitGroups").select2("destroy")};e("#onlyofficeGroups").click(n),n();const i=function(){e("#onlyofficeAddrSettings input:not(#onlyofficeStorageUrl)").prop("disabled",e("#onlyofficeDemo").prop("checked"))};e("#onlyofficeDemo").click(i),i(),e("#onlyofficeWatermark_enabled").click((function(){e("#onlyofficeWatermarkSettings").toggleClass("onlyoffice-hide",!e("#onlyofficeWatermark_enabled").prop("checked"))})),e("#onlyofficeWatermark_shareAll").click((function(){e("#onlyofficeWatermark_shareRead").parent().toggleClass("onlyoffice-hide")})),e("#onlyofficeWatermark_linkAll").click((function(){e("#onlyofficeWatermark_link_sensitive").toggleClass("onlyoffice-hide")}));const l=["allGroups"],a=["allTags","linkTags"],f=function(c){const n=function(){e("#onlyofficeWatermark_"+c).prop("checked")?c.indexOf("Group")>=0?o.Settings.setupGroupsSelect(e("#onlyofficeWatermark_"+c+"List")):e("#onlyofficeWatermark_"+c+"List").select2({allowClear:!0,closeOnSelect:!1,multiple:!0,separator:"|",toggleSelect:!0,placeholder:t(OCA.Onlyoffice.AppName,"Select tag"),query:_.debounce((function(e){e.callback({results:o.SystemTags.collection.filterByName(e.term)})}),100,!0),initSelection(c,n){n((e(c).val()||[]).split("|").map((function(e){return o.SystemTags.collection.get(e)})))},formatResult:e=>o.SystemTags.getDescriptiveTag(e),formatSelection:e=>e.get("name"),sortResults:e=>(e.sort((function(e,c){return o.Util.naturalSortCompare(e.get("name"),c.get("name"))})),e)}):e("#onlyofficeWatermark_"+c+"List").select2("destroy")};e("#onlyofficeWatermark_"+c).click(n),n()};e.each(l,(function(e,o){f(o)})),o.SystemTags&&o.SystemTags.collection&&o.SystemTags.collection.fetch({success(){e.each(a,(function(e,o){f(o)}))}}),e("#onlyofficeAddrSave").click((function(){e(".section-onlyoffice").addClass("icon-loading");const c=e("#onlyofficeUrl").val().trim();c.length||e("#onlyofficeInternalUrl, #onlyofficeStorageUrl, #onlyofficeSecret, #onlyofficeJwtHeader").val("");const n=(e("#onlyofficeInternalUrl:visible").val()||"").trim(),i=(e("#onlyofficeStorageUrl:visible").val()||"").trim(),l=e("#onlyofficeVerifyPeerOff").prop("checked"),a=(e("#onlyofficeSecret:visible").val()||"").trim(),f=(e("#onlyofficeJwtHeader:visible").val()||"").trim(),s=e("#onlyofficeDemo").prop("checked");e.ajax({method:"PUT",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/address"),data:{documentserver:c,documentserverInternal:n,storageUrl:i,verifyPeerOff:l,secret:a,jwtHeader:f,demo:s},success:function(o){if(e(".section-onlyoffice").removeClass("icon-loading"),o&&(null!=o.documentserver||s)){e("#onlyofficeUrl").val(o.documentserver),e("#onlyofficeInternalUrl").val(o.documentserverInternal),e("#onlyofficeStorageUrl").val(o.storageUrl),e("#onlyofficeSecret").val(o.secret),e("#onlyofficeJwtHeader").val(o.jwtHeader),e(".section-onlyoffice-common, .section-onlyoffice-templates, .section-onlyoffice-watermark").toggleClass("onlyoffice-hide",null==o.documentserver&&!s||!!o.error.length);const c=o.version?" ("+t(OCA.Onlyoffice.AppName,"version")+" "+o.version+")":"";o.error?OCP.Toast.error(t(OCA.Onlyoffice.AppName,"Error when trying to connect")+" ("+o.error+")"+c):OCP.Toast.success(t(OCA.Onlyoffice.AppName,"Settings have been successfully updated")+c)}else e(".section-onlyoffice-common, .section-onlyoffice-templates, .section-onlyoffice-watermark").addClass("onlyoffice-hide")}})})),e("#onlyofficeSave").click((function(){e(".section-onlyoffice").addClass("icon-loading");const c={};e('input[id^="onlyofficeDefFormat"]').each((function(){c[this.name]=this.checked}));const n={};e('input[id^="onlyofficeEditFormat"]').each((function(){n[this.name]=this.checked}));const i=e("#onlyofficeSameTab").is(":checked"),l=e("#onlyofficeEnableSharing").is(":checked"),a=e("#onlyofficePreview").is(":checked"),f=e("#onlyofficeAdvanced").is(":checked"),s=e("#onlyofficeCronChecker").is(":checked"),r=e("#onlyofficeEmailNotifications").is(":checked"),y=e("#onlyofficeVersionHistory").is(":checked"),d=e("#onlyofficeGroups").prop("checked")?e("#onlyofficeLimitGroups").val():"",p=d?d.split("|"):[],m=e("#onlyofficeChat").is(":checked"),u=e("#onlyofficeCompactHeader").is(":checked"),h=e("#onlyofficeFeedback").is(":checked"),k=e("#onlyofficeForcesave").is(":checked"),g=e("#onlyofficeHelp").is(":checked"),C=e("#onlyofficeToolbarNoTabs").is(":checked"),O=e("input[type='radio'][name='reviewDisplay']:checked").attr("id").replace("onlyofficeReviewDisplay_",""),v=e("input[type='radio'][name='theme']:checked").attr("id").replace("onlyofficeTheme_",""),A=e("#onlyofficeUnknownAuthor").val().trim();e.ajax({method:"PUT",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/common"),data:{defFormats:c,editFormats:n,sameTab:i,enableSharing:l,preview:a,advanced:f,cronChecker:s,emailNotifications:r,versionHistory:y,limitGroups:p,chat:m,compactHeader:u,feedback:h,forcesave:k,help:g,toolbarNoTabs:C,reviewDisplay:O,theme:v,unknownAuthor:A},success:function(o){e(".section-onlyoffice").removeClass("icon-loading"),o&&OCP.Toast.success(t(OCA.Onlyoffice.AppName,"Settings have been successfully updated"))}})})),e("#onlyofficeSecuritySave").click((function(){e(".section-onlyoffice").addClass("icon-loading");const c=e("#onlyofficePlugins").is(":checked"),n=e("#onlyofficeMacros").is(":checked"),i=e("input[type='radio'][name='protection']:checked").attr("id").replace("onlyofficeProtection_",""),f={enabled:e("#onlyofficeWatermark_enabled").is(":checked")};if(f.enabled){f.text=(e("#onlyofficeWatermark_text").val()||"").trim();const o=["allGroups","allTags","linkAll","linkRead","linkSecure","linkTags","shareAll","shareRead"];e.each(o,(function(o,c){f[c]=e("#onlyofficeWatermark_"+c).is(":checked")})),e.each(l.concat(a),(function(o,c){const n=e("#onlyofficeWatermark_"+c).is(":checked")?e("#onlyofficeWatermark_"+c+"List").val():"";f[c+"List"]=n?n.split("|"):[]}))}e.ajax({method:"PUT",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/security"),data:{watermarks:f,plugins:c,macros:n,protection:i},success:function(o){e(".section-onlyoffice").removeClass("icon-loading"),o&&OCP.Toast.success(t(OCA.Onlyoffice.AppName,"Settings have been successfully updated"))}})})),e(".section-onlyoffice-addr input").keypress((function(o){13===(o.keyCode||o.which)&&e("#onlyofficeAddrSave").click()})),e("#onlyofficeSecret-show").click((function(){"password"===e("#onlyofficeSecret").attr("type")?e("#onlyofficeSecret").attr("type","text"):e("#onlyofficeSecret").attr("type","password")})),e("#onlyofficeClearVersionHistory").click((function(){e(".section-onlyoffice").addClass("icon-loading"),e.ajax({method:"DELETE",url:o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/ajax/settings/history"),success:function(o){e(".section-onlyoffice").removeClass("icon-loading"),o&&OCP.Toast.success(t(OCA.Onlyoffice.AppName,"All history successfully deleted"))}})})),e("#onlyofficeAddTemplate").change((function(){const o=this.files[0];(new FormData).append("file",o),e(".section-onlyoffice").addClass("icon-loading"),OCA.Onlyoffice.AddTemplate(o,((o,c)=>{e(".section-onlyoffice").removeClass("icon-loading");const n=c?t(OCA.Onlyoffice.AppName,"Error")+": "+c:t(OCA.Onlyoffice.AppName,"Template successfully added");c?OCP.Toast.error(n):(o&&OCA.Onlyoffice.AttachItemTemplate(o),OCP.Toast.success(n))}))})),e(document).on("click",".onlyoffice-template-delete",(function(o){const c=e(o.target).parents(".onlyoffice-template-item"),n=e(c).attr("data-id");e(".section-onlyoffice").addClass("icon-loading"),OCA.Onlyoffice.DeleteTemplate(n,(o=>{e(".section-onlyoffice").removeClass("icon-loading");const n=o.error?t(OCA.Onlyoffice.AppName,"Error")+": "+o.error:t(OCA.Onlyoffice.AppName,"Template successfully deleted");o.error?OCP.Toast.error(n):(e(c).detach(),OCP.Toast.success(n))}))})),e(document).on("click",".onlyoffice-template-item p",(function(c){const n=e(c.target).parents(".onlyoffice-template-item"),t=e(n).attr("data-id"),i=o.generateUrl("/apps/"+OCA.Onlyoffice.AppName+"/{fileId}?template={template}",{fileId:t,template:"true"});window.open(i)})),e(document).on("click",".onlyoffice-template-download",(function(c){const n=e(c.target).parents(".onlyoffice-template-item"),t=e(n).attr("data-id"),i=o.generateUrl("apps/"+OCA.Onlyoffice.AppName+"/downloadas?fileId={fileId}&template={template}",{fileId:t,template:"true"});location.href=i}));const s=document.getElementById("onlyofficeSameTab"),r=document.getElementById("onlyofficeEnableSharingBlock"),y=document.getElementById("onlyofficeEnableSharing");s.onclick=function(){const e=s.checked;r.style.display=e?"none":"block",y.checked=!!e&&y.checked}}))}(jQuery,OC);
//# sourceMappingURL=onlyoffice-settings.js.map?v=d00a89dbe7e312eb6727