/*! third party licenses: js/vendor.LICENSE.txt */
import{n as r,r as u,t as h,a as p,N as v,b as f,c as g,d as m,l as _,e as b,f as w,V as l,g as C}from"./NcCheckboxRadioSwitch-VeztTzpz-Dw5vXsJM.chunk.mjs";import{_ as y,l as n}from"./index-BZGs7a1j.chunk.mjs";import"./vendor-BeFBwUwf.chunk.mjs";const S={name:"CheckboxMarkedCircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var k=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon checkbox-marked-circle-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},x=[],L=r(S,k,x,!1,null,null);const N=L.exports,z={name:"AlertDecagramIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var U=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon alert-decagram-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M23,12L20.56,9.22L20.9,5.54L17.29,4.72L15.4,1.54L12,3L8.6,1.54L6.71,4.72L3.1,5.53L3.44,9.21L1,12L3.44,14.78L3.1,18.47L6.71,19.29L8.6,22.47L12,21L15.4,22.46L17.29,19.28L20.9,18.46L20.56,14.78L23,12M13,17H11V15H13V17M13,13H11V7H13V13Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},A=[],H=r(z,U,A,!1,null,null);const M=H.exports,V={name:"AlertIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var F=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon alert-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13 14H11V9H13M13 18H11V16H13M1 21H23L12 2L1 21Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},I=[],T=r(V,F,I,!1,null,null);const c=T.exports,$={name:"InformationIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var B=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon information-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},R=[],W=r($,B,R,!1,null,null);const D=W.exports,E={name:"NcNoteCard",props:{type:{type:String,default:"warning",validator:t=>["success","info","warning","error"].includes(t)},showAlert:{type:Boolean,default:!1},heading:{type:String,default:""},text:{type:String,default:""}},computed:{shouldShowAlert(){return this.showAlert||this.type==="error"},icon(){switch(this.type){case"error":return M;case"success":return N;case"info":return D;case"warning":return c;default:return c}},color(){switch(this.type){case"error":return"var(--color-error)";case"success":return"var(--color-success)";case"info":return"var(--color-info)";case"warning":return"var(--color-warning)";default:return"var(--color-warning)"}}}};var Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notecard",class:`notecard--${t.type}`,attrs:{role:t.shouldShowAlert?"alert":"note"}},[t._t("icon",function(){return[e(t.icon,{tag:"component",staticClass:"notecard__icon",class:{"notecard__icon--heading":t.heading},attrs:{"fill-color":t.color,size:20}})]}),e("div",[t.heading?e("p",{staticClass:"notecard__heading"},[t._v(" "+t._s(t.heading)+" ")]):t._e(),t._t("default",function(){return[e("p",{staticClass:"notecard__text"},[t._v(" "+t._s(t.text)+" ")])]})],2)],2)},j=[],q=r(E,Z,j,!1,null,"7df28e9e");const G=q.exports;u(h);const J={name:"HelpCircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var K=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon help-circle-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},O=[],P=r(J,K,O,!1,null,null);const Q=P.exports,X={name:"NcSettingsSection",components:{HelpCircle:Q},props:{name:{type:String,required:!0},description:{type:String,default:""},docUrl:{type:String,default:""},limitWidth:{type:Boolean,default:!0}},data(){return{docNameTranslated:p("External documentation for {name}",{name:this.name})}},computed:{forceLimitWidth(){if(this.limitWidth)return!0;const[t]=window._oc_config?.version.split(".",2)??[];return t&&Number.parseInt(t)>=30},hasDescription(){return this.description.length>0},hasDocUrl(){return this.docUrl.length>0}}};var Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"settings-section",class:{"settings-section--limit-width":t.forceLimitWidth}},[e("h2",{staticClass:"settings-section__name"},[t._v(" "+t._s(t.name)+" "),t.hasDocUrl?e("a",{staticClass:"settings-section__info",attrs:{href:t.docUrl,title:t.docNameTranslated,"aria-label":t.docNameTranslated,target:"_blank",rel:"noreferrer nofollow"}},[e("HelpCircle",{attrs:{size:20}})],1):t._e()]),t.hasDescription?e("p",{staticClass:"settings-section__desc"},[t._v(" "+t._s(t.description)+" ")]):t._e(),t._t("default")],2)},tt=[],et=r(X,Y,tt,!1,null,"6f6953b5");const it=et.exports;function rt(t,e,i,s,o,d,ct,dt){var a=typeof t=="function"?t.options:t;return e&&(a.render=e,a.staticRenderFns=i,a._compiled=!0),a._scopeId="data-v-"+d,{exports:t,options:a}}const nt={name:"Settings",components:{NcTextField:m,NcButton:g,NcLoadingIcon:f,NcNoteCard:G,NcCheckboxRadioSwitch:v,NcSettingsSection:it},data(){return{serverUrl:n("whiteboard","url",""),serverUrlInternal:n("whiteboard","urlInternal",""),secret:n("whiteboard","secret",""),maxFileSize:n("whiteboard","maxFileSize",10),skipTlsVerify:n("whiteboard","skipTlsVerify",!1),validConnection:void 0,connectionError:void 0,loadingSettings:!1,loadingSocket:!1,setupCheck:null}},computed:{loading(){return this.loadingSettings||this.loadingSocket}},mounted(){this.callSettings({serverUrl:this.serverUrl}),this.verifyConnection({jwt:n("whiteboard","jwt","")})},methods:{async submit(){const t=await this.callSettings({serverUrl:this.serverUrl,serverUrlInternal:this.serverUrlInternal,secret:this.secret,maxFileSize:this.maxFileSize,skipTlsVerify:this.skipTlsVerify});await this.verifyConnection(t)},async saveMaxFileSize(){await this.callSettings({maxFileSize:this.maxFileSize})},async callSettings(t={}){this.loadingSettings=!0;const{data:e}=await b.post(y("/apps/whiteboard/settings"),t);return e.check&&(this.setupCheck=e.check.severity!=="success"?e.check:null),this.loadingSettings=!1,e},async verifyConnection(t){if(!t.jwt)return;const e=new URL(this.serverUrl),i=e.pathname.replace(/\/$/,"")+"/socket.io";this.loadingSocket=!0;const s=_(e.origin,{path:i,withCredentials:!0,auth:{secret:t.jwt},transports:["websocket"],timeout:5e3});s.on("connect",()=>{this.validConnection=!0,this.connectionError=void 0,this.loadingSocket=!1}),s.on("connect_error",o=>{this.validConnection=o.message==="Connection verified",this.connectionError=this.validConnection===!1?o.message:void 0,s.close(),this.loadingSocket=!1}),s.connect()}}};var st=function(){var t=this,e=t._self._c;return e("div",[e("NcSettingsSection",{attrs:{name:t.t("whiteboard","Whiteboard server")}},[!t.loading&&t.setupCheck!==null?e("NcNoteCard",{attrs:{type:t.setupCheck.severity}},[t._v(" "+t._s(t.setupCheck.description)+" ")]):!t.loading&&t.validConnection===!0?e("NcNoteCard",{attrs:{type:"success"}},[t._v(" "+t._s(t.t("whiteboard","Whiteboard backend server is configured and connected."))+" ")]):!t.loading&&t.validConnection===!1?e("NcNoteCard",{attrs:{type:"error"}},[t._v(" "+t._s(t.t("whiteboard","Failed to verify the connection:"))+" "+t._s(t.connectionError)+" ")]):e("NcNoteCard",{attrs:{type:"info",text:t.t("whiteboard","Verifying connectionâ€¦")},scopedSlots:t._u([{key:"icon",fn:function(){return[e("NcLoadingIcon")]},proxy:!0}])}),e("p",[t._v(" "+t._s(t.t("whiteboard","Whiteboard requires a separate collaboration server that is connected to Nextcloud."))+" "),e("a",{staticClass:"external",attrs:{href:"https://github.com/nextcloud/whiteboard?tab=readme-ov-file#backend",rel:"noreferrer noopener",target:"_blank"}},[t._v(t._s(t.t("whiteboard","See the documentation on how to install it.")))])]),e("form",{on:{submit:function(i){return i.preventDefault(),t.submit.apply(null,arguments)}}},[e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","Whiteboard server URL"),value:t.serverUrl,"helper-text":t.t("whiteboard","This URL is used by the browser to connect to the whiteboard server.")},on:{"update:value":function(i){t.serverUrl=i}}})],1),e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","Internal whiteboard server URL"),value:t.serverUrlInternal,placeholder:t.serverUrl,"helper-text":t.t("whiteboard","This URL is used by the Nextcloud server to connect to the whiteboard server.")},on:{"update:value":function(i){t.serverUrlInternal=i}}})],1),e("p",[e("NcCheckboxRadioSwitch",{attrs:{type:"switch",checked:t.skipTlsVerify},on:{"update:checked":function(i){t.skipTlsVerify=i}}},[t._v(" "+t._s(t.t("whiteboard","Skip TLS certificate validation (not recommended)"))+" ")])],1),e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","Shared secret"),value:t.secret},on:{"update:value":function(i){t.secret=i}}})],1),e("p",[e("NcButton",{attrs:{type:"submit",disabled:!t.serverUrl||t.loading},on:{click:function(i){return i.preventDefault(),t.submit.apply(null,arguments)}}},[t._v(" "+t._s(t.t("whiteboard","Save settings"))+" ")])],1)])],1),e("NcSettingsSection",{attrs:{name:t.t("whiteboard","Advanced settings")}},[e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","Max file size"),value:t.maxFileSize},on:{"update:value":function(i){t.maxFileSize=i},blur:t.saveMaxFileSize}})],1)])],1)},at=[],ot=rt(nt,st,at,!1,null,"93c8754c");const lt=ot.exports;l.prototype.t=w,l.prototype.n=C,new l({render:t=>t(lt,{})}).$mount("#admin-vue");
//# sourceMappingURL=whiteboard-settings.mjs.map
