/*! third party licenses: js/vendor.LICENSE.txt */
import{n as r,r as u,t as h,a as p,N as f,b as g,c as m,l as v,d as _,e as b,V as l,f as w}from"./NcLoadingIcon-Bg5K4W6G.chunk.mjs";import{_ as C,l as a}from"./index-BZGs7a1j.chunk.mjs";import"./vendor-BeFBwUwf.chunk.mjs";const S={name:"CheckboxMarkedCircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var y=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon checkbox-marked-circle-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},k=[],x=r(S,y,k,!1,null,null);const L=x.exports,N={name:"AlertDecagramIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var z=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon alert-decagram-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M23,12L20.56,9.22L20.9,5.54L17.29,4.72L15.4,1.54L12,3L8.6,1.54L6.71,4.72L3.1,5.53L3.44,9.21L1,12L3.44,14.78L3.1,18.47L6.71,19.29L8.6,22.47L12,21L15.4,22.46L17.29,19.28L20.9,18.46L20.56,14.78L23,12M13,17H11V15H13V17M13,13H11V7H13V13Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},A=[],H=r(N,z,A,!1,null,null);const M=H.exports,U={name:"AlertIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var F=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon alert-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13 14H11V9H13M13 18H11V16H13M1 21H23L12 2L1 21Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},$=[],V=r(U,F,$,!1,null,null);const c=V.exports,W={name:"InformationIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var B=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon information-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},I=[],T=r(W,B,I,!1,null,null);const D=T.exports,E={name:"NcNoteCard",props:{type:{type:String,default:"warning",validator:t=>["success","info","warning","error"].includes(t)},showAlert:{type:Boolean,default:!1},heading:{type:String,default:""},text:{type:String,default:""}},computed:{shouldShowAlert(){return this.showAlert||this.type==="error"},icon(){switch(this.type){case"error":return M;case"success":return L;case"info":return D;case"warning":return c;default:return c}},color(){switch(this.type){case"error":return"var(--color-error)";case"success":return"var(--color-success)";case"info":return"var(--color-info)";case"warning":return"var(--color-warning)";default:return"var(--color-warning)"}}}};var R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notecard",class:`notecard--${t.type}`,attrs:{role:t.shouldShowAlert?"alert":"note"}},[t._t("icon",function(){return[e(t.icon,{tag:"component",staticClass:"notecard__icon",class:{"notecard__icon--heading":t.heading},attrs:{"fill-color":t.color,size:20}})]}),e("div",[t.heading?e("p",{staticClass:"notecard__heading"},[t._v(" "+t._s(t.heading)+" ")]):t._e(),t._t("default",function(){return[e("p",{staticClass:"notecard__text"},[t._v(" "+t._s(t.text)+" ")])]})],2)],2)},Z=[],j=r(E,R,Z,!1,null,"7df28e9e");const q=j.exports;u(h);const J={name:"HelpCircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var G=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon help-circle-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(i){return t.$emit("click",i)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},K=[],O=r(J,G,K,!1,null,null);const P=O.exports,Q={name:"NcSettingsSection",components:{HelpCircle:P},props:{name:{type:String,required:!0},description:{type:String,default:""},docUrl:{type:String,default:""},limitWidth:{type:Boolean,default:!0}},data(){return{docNameTranslated:p("External documentation for {name}",{name:this.name})}},computed:{forceLimitWidth(){if(this.limitWidth)return!0;const[t]=window._oc_config?.version.split(".",2)??[];return t&&Number.parseInt(t)>=30},hasDescription(){return this.description.length>0},hasDocUrl(){return this.docUrl.length>0}}};var X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"settings-section",class:{"settings-section--limit-width":t.forceLimitWidth}},[e("h2",{staticClass:"settings-section__name"},[t._v(" "+t._s(t.name)+" "),t.hasDocUrl?e("a",{staticClass:"settings-section__info",attrs:{href:t.docUrl,title:t.docNameTranslated,"aria-label":t.docNameTranslated,target:"_blank",rel:"noreferrer nofollow"}},[e("HelpCircle",{attrs:{size:20}})],1):t._e()]),t.hasDescription?e("p",{staticClass:"settings-section__desc"},[t._v(" "+t._s(t.description)+" ")]):t._e(),t._t("default")],2)},Y=[],tt=r(Q,X,Y,!1,null,"6f6953b5");const et=tt.exports;function it(t,e,i,n,o,d,lt,ct){var s=typeof t=="function"?t.options:t;return e&&(s.render=e,s.staticRenderFns=i,s._compiled=!0),s._scopeId="data-v-"+d,{exports:t,options:s}}const rt={name:"Settings",components:{NcTextField:m,NcButton:g,NcLoadingIcon:f,NcNoteCard:q,NcSettingsSection:et},data(){return{serverUrl:a("whiteboard","url",""),secret:a("whiteboard","secret",""),maxFileSize:a("whiteboard","maxFileSize",10),validConnection:void 0,connectionError:void 0,loadingSettings:!1,loadingSocket:!1,setupCheck:null}},computed:{loading(){return this.loadingSettings||this.loadingSocket}},mounted(){this.callSettings({serverUrl:this.serverUrl}),this.verifyConnection({jwt:a("whiteboard","jwt","")})},methods:{async submit(){const t=await this.callSettings({serverUrl:this.serverUrl,secret:this.secret,maxFileSize:this.maxFileSize});await this.verifyConnection(t)},async saveMaxFileSize(){await this.callSettings({maxFileSize:this.maxFileSize})},async callSettings(t={}){this.loadingSettings=!0;const{data:e}=await _.post(C("/apps/whiteboard/settings"),t);return e.check&&(this.setupCheck=e.check.severity!=="success"?e.check:null),this.loadingSettings=!1,e},async verifyConnection(t){if(!t.jwt)return;const e=new URL(this.serverUrl),i=e.pathname.replace(/\/$/,"")+"/socket.io";this.loadingSocket=!0;const n=v(e.origin,{path:i,withCredentials:!0,auth:{secret:t.jwt},transports:["websocket"],timeout:5e3});n.on("connect",()=>{this.validConnection=!0,this.connectionError=void 0,this.loadingSocket=!1}),n.on("connect_error",o=>{this.validConnection=o.message==="Connection verified",this.connectionError=this.validConnection===!1?o.message:void 0,n.close(),this.loadingSocket=!1}),n.connect()}}};var nt=function(){var t=this,e=t._self._c;return e("div",[e("NcSettingsSection",{attrs:{name:t.t("whiteboard","Real-time collaboration server")}},[!t.loading&&t.setupCheck!==null?e("NcNoteCard",{attrs:{type:t.setupCheck.severity}},[t._v(" "+t._s(t.setupCheck.description)+" ")]):!t.loading&&t.validConnection===!0?e("NcNoteCard",{attrs:{type:"success"}},[t._v(" "+t._s(t.t("whiteboard","WebSocket server for real-time collaboration is configured and connected."))+" ")]):!t.loading&&t.validConnection===!1?e("NcNoteCard",{attrs:{type:"error"}},[t._v(" "+t._s(t.t("whiteboard","Failed to verify the connection:"))+" "+t._s(t.connectionError)+" ")]):e("NcNoteCard",{attrs:{type:"info",text:t.t("whiteboard","Verifying connectionâ€¦")},scopedSlots:t._u([{key:"icon",fn:function(){return[e("NcLoadingIcon")]},proxy:!0}])}),e("p",[t._v(" "+t._s(t.t("whiteboard","The WebSocket server handles real-time collaboration sessions between users. Basic whiteboard functionality works without it, but real-time collaboration requires this server to be running and accessible from users' browsers."))+" ")]),e("p",[e("a",{staticClass:"external",attrs:{href:"https://github.com/nextcloud/whiteboard?tab=readme-ov-file#websocket-server-for-real-time-collaboration",rel:"noreferrer noopener",target:"_blank"}},[t._v(t._s(t.t("whiteboard","See the documentation on how to install and configure the WebSocket server.")))])]),e("form",{on:{submit:function(i){return i.preventDefault(),t.submit.apply(null,arguments)}}},[e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","WebSocket server URL"),value:t.serverUrl,"helper-text":t.t("whiteboard","URL where the WebSocket server for real-time collaboration is running. Must be accessible from users' browsers.")},on:{"update:value":function(i){t.serverUrl=i}}})],1),e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","Shared secret"),value:t.secret,"helper-text":t.t("whiteboard","JWT secret key shared between Nextcloud and the WebSocket server for secure authentication.")},on:{"update:value":function(i){t.secret=i}}})],1),e("p",[e("NcButton",{attrs:{type:"submit",disabled:!t.serverUrl||t.loading},on:{click:function(i){return i.preventDefault(),t.submit.apply(null,arguments)}}},[t._v(" "+t._s(t.t("whiteboard","Save settings"))+" ")])],1)])],1),e("NcSettingsSection",{attrs:{name:t.t("whiteboard","Advanced settings")}},[e("p",[e("NcTextField",{attrs:{label:t.t("whiteboard","Max file size"),value:t.maxFileSize},on:{"update:value":function(i){t.maxFileSize=i},blur:t.saveMaxFileSize}})],1)])],1)},st=[],at=it(rt,nt,st,!1,null,"1ba49815");const ot=at.exports;l.prototype.t=b,l.prototype.n=w,new l({render:t=>t(ot,{})}).$mount("#admin-vue");
//# sourceMappingURL=whiteboard-settings.mjs.map
